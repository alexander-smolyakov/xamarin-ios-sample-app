steps:

- task: Bash@3
  displayName: 'Set Xamarin & Mono'
  inputs:
    targetType: filePath
    filePath: src/xamarin-ios/select-xamarin.sh
    arguments: ${{ parameters.XAMARIN_SYMLINK }}

- task: Bash@3
  displayName: 'Set Xcode'
  inputs:
    targetType: filePath
    filePath: src/xamarin-ios/select-xcode.sh
    arguments: ${{ parameters.XCODE_VERSION }}

- task: InstallAppleCertificate@1
  displayName: 'Install an Apple certificate'
  inputs:
    certSecureFile: 'DevCertificate.p12'
    certPwd: '$(certificate.Password)'
    keychain: 'temp'

- task: InstallAppleProvisioningProfile@1
  displayName: 'Install an Apple provisioning profile'
  inputs:
    provisioningProfileLocation: 'secureFiles'
    provProfileSecureFile: 'profile_application.mobileprovision'

- task: InstallAppleProvisioningProfile@1
  displayName: 'Install an Apple provisioning profile ext'
  inputs:
    provisioningProfileLocation: 'secureFiles'
    provProfileSecureFile: 'profile_extension.mobileprovision'

- task: XamariniOS@2
  displayName: 'Build Xamarin.iOS solution UsingUITest.sln'
  inputs:
    solutionFile: '$(build.sourcesdirectory)/src/xamarin-ios/xamarin-test-app.sln'
    configuration: 'Release'
    buildToolOption: msbuild
